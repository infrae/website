<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Infrae Mobile: infrae.wsgi</title>
    <base href="" />
    <meta name="description" content="Infrae mobile site: Download areas for all of Infrae's open source products." />
    <meta name="keywords" content="mobile, smartphone, Android, iOS, download, open source, software, products, infrae" />
    <meta name="generator" content="Silva" />
    <meta name="viewport" content="width=device-width,user-scalable=yes" />
    <link rel="shortcut icon" href="../../++static++/silvatheme.infraemobile/:version:2013-12-19T15:20:12/favicon.ico" />

    <link rel="apple-touch-icon" href="../../++static++/silvatheme.infraemobile/:version:2013-12-19T15:20:12/mobicon.png" />
    <style>#contactus {display: none;}</style>

    
  <link rel="stylesheet" type="text/css" href="../../++static++/silvatheme.infraemobile/:version:2013-12-19T15:20:12/:bundle:infraemobile.css%3Binfraemobile_advanced.css" />
<script type="text/javascript" src="../../++static++/jquery/:version:1.8.2/jquery.min.js"></script>
</head>

  <body class="infrae-wsgi">
    <div id="site" class="">
  <div id="header"><div class="breadcrumbs"><div class="menu bc">
  <div id="home" class="bci bchome">
    <a href="../../index.html">
      <img width="72" height="36" alt="Home" src="../../++static++/silvatheme.infraemobile/:version:2013-12-19T15:20:12/images/homelink.png"
           />
    </a>
  </div>
  <div id="sitemap-switch-button" class="buttons" >
  <a id="sitemap-switch-button-link" href="infrae.wsgi.html#top"
    width="36" height="36" alt="Sitemap"
    title="show sitemap"
    onclick="
      window.location.hash = 'top';
      var cur = $(this);
      $('#sitemap').slideToggle('fast',
      function(){cur.toggleClass('selected')});
      return false;">
    <img height="36" width="36" alt="Sitemap button" src="../../++static++/silvatheme.infraemobile/:version:2013-12-19T15:20:12/images/sitemap.png"
    />
  </a>
</div>

  <div class="title bci">
    <a href="../tools.html">Tools</a>
  </div>
</div>
</div>
</div>
  <div id="behindheader">
    <a name="top" href="mailto:torvald@infrae.com">
      Looking under the hood? Interested in a job? Send a mail....
    </a>
  </div>
  <div id="sitemap" style="display: none"><div class="navigation">
  <ul id="navigation-menu" class="navigation-level-0">
    
      <li class="level-0">
        <a href="../../news.html" title="News">News</a>
        
      </li>
    
    
      <li class="level-0">
        <a href="../../about.html" title="About">About</a>
        
      </li>
    
    
      <li class="level-0">
        <a href="../../products.html" title="Products">Products</a>
        
      </li>
    
    
      <li class="level-0 selected">
        <a href="../../download.html" title="Download" class="onbranch">Download</a>
        
          
            <ul class="navigation-level-1">
    
      <li class="level-1 selected">
        <a href="../tools.html" title="Tools" class="onbranch">Tools</a>
        
          
            <ul class="navigation-level-2">
    
      <li class="level-2 selected">
        <a href="infrae.wsgi.html" title="infrae.wsgi" class="selected">infrae.wsgi</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.testbrowser.html" title="infrae.testbrowser">infrae.testbrowser</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.fileupload.html" title="infrae.fileupload">infrae.fileupload</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.layout.html" title="infrae.layout">infrae.layout</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.rest.html" title="infrae.rest">infrae.rest</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.testing.html" title="infrae.testing">infrae.testing</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.i18nextract.html" title="infrae.i18nextract">infrae.i18nextract</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.maildrophost.html" title="infrae.maildrophost">infrae.maildrophost</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.uwsgi.html" title="infrae.uwsgi">infrae.uwsgi</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.copyright.html" title="infrae.copyright">infrae.copyright</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.cache.html" title="infrae.cache">infrae.cache</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="infrae.comethods.html" title="infrae.comethods">infrae.comethods</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="z3locales.html" title="z3locales">z3locales</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="sparrow.html" title="Sparrow">Sparrow</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="../Sprout.html" title="Sprout">Sprout</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="../../infrae.com/infrae.com/download/ptprofiler.html" title="PTProfiler">PTProfiler</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="../zsparklines.html" title="ZSparklines">ZSparklines</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="i18nextract-sa.html" title="i18nextract stand-alone">i18nextract stand-alone</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="../pydavclient.html" title="PyDAV Client">PyDAV Client</a>
        
      </li>
    
  </ul>
          
        
      </li>
    
    
      <li class="level-1">
        <a href="../mobi.html" title="Mobi">Mobi</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../OAI.html" title="OAI Components">OAI Components</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../DocumentLibrary.html" title="OAI Document Library">OAI Document Library</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../silva_all.html" title="Silva CMS Packages">Silva CMS Packages</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../silva_all_archive.html" title="Silva CMS Archive">Silva CMS Archive</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../silva_components.html" title="Silva Components">Silva Components</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../silva_extensions.html" title="Silva Extensions">Silva Extensions</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../silva_extensions_archive.html" title="Silva Extensions Archive">Silva Extensions Archive</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../fedoracommons.html" title="Fedora Commons Repository">Fedora Commons Repository</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../railroad.html" title="Railroad Repository">Railroad Repository</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../tramline.html" title="Tramline">Tramline</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../Formulator.html" title="Formulator">Formulator</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../LICENSE.txt.html" title="License">License</a>
        
      </li>
    
  </ul>
          
        
      </li>
    
    
      <li class="level-0">
        <a href="../../service.html" title="Services">Services</a>
        
      </li>
    
    
      <li class="level-0">
        <a href="../../contact.html" title="Contact">Contact</a>
        
      </li>
    
    
      <li class="level-0">
        <a href="../../presentations.html" title="Presentations">Presentations</a>
        
      </li>
    
    
      <li class="level-0">
        <a href="../../search.html" title="Inactive Search">Inactive Search</a>
        
      </li>
    
  </ul>
</div>
</div>
  <div id="content">
    
    

  <a href="infrae.wsgi.html#skip-to-releases" class="skip-link"
     style="float: right">
    Jump to releases
  </a>

  

  
  <h1>infrae.wsgi</h1>
  <div class="document" id="infrae-wsgi">
<p><tt class="docutils literal">infrae.wsgi</tt> provides a support to run Zope 2 as a WSGI application.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple"><li><a class="reference internal" href="infrae.wsgi.html#introduction" id="id1">Introduction</a><ul><li><a class="reference internal" href="infrae.wsgi.html#errors" id="id2">Errors</a></li>
</ul></li>
<li><a class="reference internal" href="infrae.wsgi.html#installation" id="id3">Installation</a><ul><li><a class="reference internal" href="infrae.wsgi.html#paste-deploy" id="id4">Paste Deploy</a></li>
<li><a class="reference internal" href="infrae.wsgi.html#virtual-hosting" id="id5">Virtual Hosting</a></li>
</ul></li>
<li><a class="reference internal" href="infrae.wsgi.html#testing" id="id6">Testing</a><ul><li><a class="reference internal" href="infrae.wsgi.html#functional-testing" id="id7">Functional Testing</a></li>
</ul></li>
</ul></div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="infrae.wsgi.html#id1">Introduction</a></h2>
<p>It basically does the same work than:</p>
<ul class="simple"><li><tt class="docutils literal">repoze.zope2</tt>,</li>
<li>Zope 2 new builtin WSGI publisher.</li>
</ul><p>Except than:</p>
<ul class="simple"><li>It work with real Zope 2 applications and no monkey-patches,</li>
<li>It pay specially attention to properly implement streaming. You can
use your ZODB connection while streaming, (either with the
<tt class="docutils literal">.write</tt> method of request, or returning an <tt class="docutils literal">IResult</tt> or an
<tt class="docutils literal">IStreamIterator</tt> iterator). ConflictError generate a final error
if they happens during a streaming operation, not re-sending things
again on the same HTTP connection,</li>
<li>All ConflictError are properly managed.</li>
<li>All those cases are tested.</li>
</ul><p>It does not:</p>
<ul class="simple"><li>Provide Zope 2 as a collection of WSGI middlewares, as Zope 2 paradigm /
code base is not good for it,</li>
<li>Do all fancy request body changes that old Zope 2 publisher does, as
nobody use it anymore since a very long time.</li>
</ul><div class="section" id="errors">
<h3><a class="toc-backref" href="infrae.wsgi.html#id2">Errors</a></h3>
<p>Error messages are handled a bit differently than in
traditional Zope 2, in order to make things simpler.</p>
<p>They are views on errors (called <tt class="docutils literal">error.html</tt>), and wrapped in
acquisition around the context where they happened:</p>
<pre class="literal-block">
from five import grok

class CorpError(Exception):
    """Custom corporate error.
    """

class CorpErrorMessage(grok.View):
    grok.context(CorpError)
    grok.name('error.html')

    def render(self):
        # aq_parent(self) is where the error happened
        return u'I Failed: %s' % str(self.error.args)
</pre>
<p>Errors are logged with useful information:</p>
<ul class="simple"><li>Which is the URL triggering this error,</li>
<li>The user-agent,</li>
<li>The referent,</li>
<li>The logged in username,</li>
<li>On which object, its physical path and meta_type if possible.</li>
</ul><p>The error log can be accessible online via <tt class="docutils literal">/errorlog.html</tt> on any
Zope 2 content.</p>
<p>Errors can also be sent to a Sentry service (see Paste Deploy section).</p>
<p>The error log ignores certain errors by default: NotFound, Redirect,
Unauthorized, Forbidden, BadRequest, BrokenReferenceError.  The errlog.html page
has a form configure some (or all) of these errors to not be ignored.  This is
not a persistent setting and is forgotten on restart.</p>
</div>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="infrae.wsgi.html#id3">Installation</a></h2>
<p><tt class="docutils literal">infrae.wsgi</tt> has been and deployed with Paste Deploy, <tt class="docutils literal">mod_wsgi</tt>
and <tt class="docutils literal">nginx</tt>. It correctly respect the WSGI specification and should
work with any WSGI server.</p>
<div class="section" id="paste-deploy">
<h3><a class="toc-backref" href="infrae.wsgi.html#id4">Paste Deploy</a></h3>
<p>The application is available with the entry point
<tt class="docutils literal">infrae.wsgi#zope2</tt>.</p>
<p>It expect an option variable called <tt class="docutils literal">zope_conf</tt> that point to the
Zope 2 configuration file.</p>
<p>The option <tt class="docutils literal">debug_mode</tt> can as well be specified, to run Zope in
debug mode. In debug mode, error pages will not be rendered by Zope
and the errors will propagate in the WSGI stack. This behavior will
let you debug errors with specialized middlewares.</p>
<p>To disable the error propagation in debug mode, the option
<tt class="docutils literal">debug_exceptions</tt> can be set to <tt class="docutils literal">off</tt>.</p>
<p>The option <tt class="docutils literal">zope_workers</tt> can be used to specify the maximum of
threads Zope should allow to process requests at the same time
(default to <tt class="docutils literal">4</tt>). This can be usefull if you wish to allow more
threads in your wsgi environment, in case you have middlewares or
other applications that intercept the requests and support more
threads than Zope does.</p>
<p>The option <tt class="docutils literal">show_errors</tt> accepts a comma-separated list of
errors which will not be ignored. This overrides the default list of
ignored errors (see the Errors section, above)</p>
<p>The option <tt class="docutils literal">ignore_errors</tt> accepts a comma-separated list of errors
which will be ignored. This overrides the default list of ignored
errors too.</p>
<p>The configuration accepts options for <a class="reference external" href="http://raven.readthedocs.org/en/latest/">Raven</a> (Sentry's client):</p>
<pre class="literal-block">
raven.dsn = http://public:secret@example.com/1
raven.include_paths = my.package, my.other.package
raven.exclude_paths = my.package.crud
</pre>
<p>Those options requires <a class="reference external" href="http://raven.readthedocs.org/en/latest/">Raven</a> to be installed.</p>
</div>
<div class="section" id="virtual-hosting">
<h3><a class="toc-backref" href="infrae.wsgi.html#id5">Virtual Hosting</a></h3>
<p>You can add two headers in your proxy in order to control the virtual
hosting:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre">X-VHM-URL</span></tt>: That would the complete URL of your site, at which
you want to see your Zope application, like
<tt class="docutils literal"><span class="pre">http://www.mysite.com/application</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">X-VHM-Path</span></tt>: That would be an optional path to the Zope folder
you see at the given URL instead of the Zope root, lile
<tt class="docutils literal">/my/folder</tt>.</li>
</ul></div>
</div>
<div class="section" id="testing">
<h2><a class="toc-backref" href="infrae.wsgi.html#id6">Testing</a></h2>
<p>A test request <tt class="docutils literal">TestRequest</tt> can be imported from
<tt class="docutils literal">infrae.wsgi.testing</tt>. It behaves <em>exactly</em> like a request used by
Zope. It takes the following parameters when creating it:</p>
<dl class="docutils"><dt><tt class="docutils literal">application</tt></dt>
<dd>WSGI application to use with the request.</dd>
<dt><tt class="docutils literal">layers</tt></dt>
<dd>Zope layers to apply on the request.</dd>
<dt><tt class="docutils literal">url</tt></dt>
<dd>URL used with the request.</dd>
<dt><tt class="docutils literal">method</tt></dt>
<dd>HTTP method used with the request.</dd>
<dt><tt class="docutils literal">headers</tt></dt>
<dd>HTTP headers that where sent with the request.</dd>
<dt><tt class="docutils literal">debug</tt></dt>
<dd>Should the request ran with the debug mode.</dd>
<dt><tt class="docutils literal">form</tt></dt>
<dd>Form data associated with the request.</dd>
</dl><div class="section" id="functional-testing">
<h3><a class="toc-backref" href="infrae.wsgi.html#id7">Functional Testing</a></h3>
<p>A layer inheriting of <a class="reference external" href="http://pypi.python.org/pypi/infrae.testing">infrae.testing</a> <tt class="docutils literal">Zope2Layer</tt> layer called
<tt class="docutils literal">ZopeBrowserLayer</tt> let you write functional tests.</p>
<p>It provides both an <tt class="docutils literal">http</tt> function and a <tt class="docutils literal">ZopeBrowser</tt> class (like
the one provided by <tt class="docutils literal">zope.testbrowser</tt>) that you can use, and that
will connect to the tested application using the WSGI support provided
by this package.</p>
<p>This will let you do functional testing, and things will work exactly
like in your browser, as the requests will be processed the same way
than they are in real life (which is not really the case with the
<tt class="docutils literal">Testing</tt> module of Zope 2).</p>
<p>You will be actually able to test applications that do use streaming:</p>
<pre class="literal-block">
import unittest

from infrae.wsgi.testing import ZopeBrowser, ZopeBrowserLayer
import corp.testpackage


class CorpTestCase(unittest.TestCase):
   layer = BrowserLayer(corp.testpackage)

   def setUp(self):
       self.root = self.layer.get_application()
       # Create some test content

   def test_feature(self):
       browser = ZopeBrowser()
       browser.open('http://localhost/somepage')
       self.assertEqual(browser.status, 200)
       ...
</pre>
<p>This feature is provided by <a class="reference external" href="http://pypi.python.org/pypi/wsgi_intercept">wsgi_intercept</a>. It is available only if
<a class="reference external" href="http://pypi.python.org/pypi/wsgi_intercept">wsgi_intercept</a> is included in the environment.</p>
</div>
</div>
</div>




  <table class="silvatable list">
    <h2><a name="skip-to-releases">Available releases</a></h2>
    <thead>
      <tr>
        <th class="align-left">Release version</th>
        <th class="align-left">Release date</th>
        <th class="align-left">Release files</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <a href="infrae.wsgi/2.2.1.html">infrae.wsgi 2.2.1</a>
        </td>
        <td>2013 10 8  15:20:23 </td>
        <td>
          
            <a href="infrae.wsgi/2.2.1/infrae.wsgi-2.2.1.tar.gz">infrae.wsgi-2.2.1.tar.gz</a><br />
          
        </td>
      </tr>
      <tr>
        <td>
          <a href="infrae.wsgi/2.2.html">infrae.wsgi 2.2</a>
        </td>
        <td>2013 5 22  14:37:47 </td>
        <td>
          
            <a href="infrae.wsgi/2.2/infrae.wsgi-2.2.tar.gz">infrae.wsgi-2.2.tar.gz</a><br />
          
        </td>
      </tr>
      <tr>
        <td>
          <a href="infrae.wsgi/2.1.html">infrae.wsgi 2.1</a>
        </td>
        <td>2012 12 10  17:02:18 </td>
        <td>
          
            <a href="infrae.wsgi/2.1/infrae.wsgi-2.1.tar.gz">infrae.wsgi-2.1.tar.gz</a><br />
          
        </td>
      </tr>
      <tr>
        <td>
          <a href="infrae.wsgi/2.0.1.html">infrae.wsgi 2.0.1</a>
        </td>
        <td>2012 9 24  12:08:32 </td>
        <td>
          
            <a href="infrae.wsgi/2.0.1/infrae.wsgi-2.0.1.tar.gz">infrae.wsgi-2.0.1.tar.gz</a><br />
          
        </td>
      </tr>
      <tr>
        <td>
          <a href="infrae.wsgi/2.0.html">infrae.wsgi 2.0</a>
        </td>
        <td>2012 9 4  11:42:46 </td>
        <td>
          
            <a href="infrae.wsgi/2.0/infrae.wsgi-2.0.tar.gz">infrae.wsgi-2.0.tar.gz</a><br />
          
        </td>
      </tr>
      <tr>
        <td>
          <a href="infrae.wsgi/1.3.html">infrae.wsgi 1.3</a>
        </td>
        <td>2011 7 27  09:54:12 </td>
        <td>
          
            <a href="infrae.wsgi/1.3/infrae.wsgi-1.3.tar.gz">infrae.wsgi-1.3.tar.gz</a><br />
          
        </td>
      </tr>
      <tr>
        <td>
          <a href="infrae.wsgi/1.2.html">infrae.wsgi 1.2</a>
        </td>
        <td>2011 2 2  15:35:38 </td>
        <td>
          
            <a href="infrae.wsgi/1.2/infrae.wsgi-1.2.tar.gz">infrae.wsgi-1.2.tar.gz</a><br />
          
        </td>
      </tr>
      <tr>
        <td>
          <a href="infrae.wsgi/1.1.html">infrae.wsgi 1.1</a>
        </td>
        <td>2010 10 7  11:40:54 </td>
        <td>
          
            <a href="infrae.wsgi/1.1/infrae.wsgi-1.1.tar.gz">infrae.wsgi-1.1.tar.gz</a><br />
          
        </td>
      </tr>
      <tr>
        <td>
          <a href="infrae.wsgi/1.0.html">infrae.wsgi 1.0</a>
        </td>
        <td>2010 7 15  18:13:16 </td>
        <td>
          
            <a href="infrae.wsgi/1.0/infrae.wsgi-1.0.tar.gz">infrae.wsgi-1.0.tar.gz</a><br />
          
        </td>
      </tr>
    </tbody>
  </table>

  <p class="software-license">
    <strong>License:</strong>
    <a href="infrae.wsgi/LICENSE.txt.html">
      New BSD
    </a>
  </p>

  



  </div>
  <div id="footer">
  <div class="search">
  <form method="get" action="http://m.infrae.com/download/tools/infrae.wsgi/@@index.html">
    <input class="searchbutton" type="image" src="../../++static++/silvatheme.infraemobile/:version:2013-12-19T15:20:12/images/search.png" />
    <div class="searchtext">
      <input class="text" placeholder="Search..." name="search" type="text"
             />
    </div>
  </form>
</div>

  <table class="nav">
  
    <tr>
      <td class="col1">
        <div class="nav_button">
          <a class="nav_button" href="../../news.html">News</a>
        </div>
      </td>
      <td class="col2">
        <div class="nav_button">
          <a class="nav_button" href="../../about.html">About</a>
        </div>
      </td>
      <td class="col3">
        <div class="nav_button">
          <a class="nav_button" href="../../products.html">Products</a>
        </div>
      </td>
    </tr>
  
  
    <tr>
      <td class="col1">
        <div class="nav_button">
          <a class="nav_button" href="../../download.html">Download</a>
        </div>
      </td>
      <td class="col2">
        <div class="nav_button">
          <a class="nav_button" href="../../service.html">Services</a>
        </div>
      </td>
      <td class="col3">
        <div class="nav_button">
          <a class="nav_button" href="../../contact.html">Contact</a>
        </div>
      </td>
    </tr>
  
  
    <tr>
      <td class="col1">
        <div class="nav_button">
          <a class="nav_button" href="../../presentations.html">Presentations</a>
        </div>
      </td>
    </tr>
  
    <tr>
      <td colspan="3" class="col0">
        <div class="nav_button">
          <a class="nav_button" href="http://infrae.com/download/tools/infrae.wsgi">
            View this page on the desktop site
          </a>
        </div>
      </td>
    </tr>
</table>

  <div class="channels">
    <a class="button" href="http://maps.google.com/maps?f=q&source=s_q&hl=en&geocode=&q=Infrae,+Rotterdam,+The+Netherlands&sll=36.244273,-95.712891&sspn=52.071158,72.949219&ie=UTF8&hq=Infrae,&hnear=Rotterdam,+South+Holland,+The+Netherlands&t=h&z=15&iwloc=A">Hoevestraat 10 3033 GC Rotterdam NL</a>
    <a href="tel:+31102437051" class="button left">+31 10 243 7051</a>
    <a class="button right" href="mailto:info@infrae.com">info@infrae.com</a>
  </div>

</div>
</div>



<script type="text/javascript">
    
    $( function(){ 
        $(document).bind('mousedown touchstart', function(){ 
            $('#sitemap').hide('fast', function(){
                $('#sitemap-switch-button-link').removeClass('selected');
            }); 
        });
        
        $('#sitemap, #sitemap-switch-button').bind('mousedown touchstart', function(event){
            event.stopPropagation();
        });       
    });
    
</script>

  </body>
</html>
